## üìå –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ setAttendance

–ú–µ—Ç–æ–¥ setAttendance($attendaceArray) –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –æ—Ç–º–µ—Ç–æ–∫ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å —É—á—ë—Ç–æ–º —Ä–æ–ª–µ–≤–æ–π –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø—Ä–∞–≤ (–∏–µ—Ä–∞—Ä—Ö–∏–∏).
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ClickHouse (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö) –∏ Kafka (–æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π).

## 1. –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å (MARKED_BY_ROLE)

3 - –î–µ–∫–∞–Ω–∞—Ç      (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ 2 –∏–ª–∏ 3.
2 - –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å ‚Äî –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π 0, 1, 4, 5.
1 - –°—Ç–∞—Ä–æ—Å—Ç–∞     ‚Äî –º–æ–∂–µ—Ç –æ—Ç–º–µ—á–∞—Ç—å –¥—Ä—É–≥–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å–≤–æ–µ–π –≥—Ä—É–ø–ø—ã.
0 - –°—Ç—É–¥–µ–Ω—Ç      ‚Äî –º–æ–∂–µ—Ç –æ—Ç–º–µ—á–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–µ–±—è.

3>2>1>0

## 2. –û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã —Ä–∞–±–æ—Ç—ã

- –≠—Ç–∞–ø 1 ‚Äî –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤.

–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π: journalId, userId, lessonId, attendance.

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (ID –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏).

–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π attendance (0, 1, 2, 3).

- –≠—Ç–∞–ø 2 ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç CurrentUser::getInstance() –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–æ–ª–∏ (employee –∏–ª–∏ student) –∏ ID.

–°–æ–∑–¥–∞—ë—Ç—Å—è –æ–±—ä–µ–∫—Ç Permission –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –∂—É—Ä–Ω–∞–ª–∞–º.

- –≠—Ç–∞–ø 3 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
–°–æ—Ç—Ä—É–¥–Ω–∏–∫ (employee):

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –∂—É—Ä–Ω–∞–ª—É —á–µ—Ä–µ–∑ FBPermission –∏–ª–∏ —Ç–∞–±–ª–∏—Ü—É JournalResponsibleTeachersTable.

–°—Ç—É–¥–µ–Ω—Ç (student):

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç—É–¥–µ–Ω—Ç —Å—Ç–∞—Ä–æ—Å—Ç–æ–π (JournalResponsibleStudentTable).

–°—Ç–∞—Ä–æ—Å—Ç–∞ –º–æ–∂–µ—Ç –æ—Ç–º–µ—á–∞—Ç—å –≤—Å–µ—Ö –≤ –∂—É—Ä–Ω–∞–ª–µ.

–û–±—ã—á–Ω—ã–π —Å—Ç—É–¥–µ–Ω—Ç ‚Äî —Ç–æ–ª—å–∫–æ —Å–µ–±—è.

- –≠—Ç–∞–ø 4 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç–∏—è
–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ LessonsTable.

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:

–°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è.

–ù–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ –æ–Ω–æ.

–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π –¥–∞—Ç—ã —Å –¥–∞—Ç–æ–π –∑–∞–Ω—è—Ç–∏—è.

- –≠—Ç–∞–ø 5 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ—Ç–º–µ—Ç–æ–∫
–ò–∑ ClickHouse (attendance_test_enriched) –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω—è—è –æ—Ç–º–µ—Ç–∫–∞ –ø–æ:

–ñ—É—Ä–Ω–∞–ª—É

–°—Ç—É–¥–µ–Ω—Ç—É

–ó–∞–Ω—è—Ç–∏—é

–î–∞—Ç–µ

- –≠—Ç–∞–ø 6 ‚Äî –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤)
–î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –æ—Ç–º–µ—Ç–∫–∞ —Å—Ç–∞–≤–∏—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ø–∞—Ä—ã (–ø–æ lessonsTime).

- –≠—Ç–∞–ø 7 ‚Äî –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è UUID.

–û–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è:

MARKED_BY ‚Äî –∫—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª –æ—Ç–º–µ—Ç–∫—É.

MARKED_BY_ROLE ‚Äî —Ä–æ–ª—å –æ—Ç–º–µ—Ç–∏–≤—à–µ–≥–æ.

–§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ $attendanceData.

- –≠—Ç–∞–ø 8 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kafka
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è \RdKafka\Producer.

–°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ —Ç–æ–ø–∏–∫ attendance_events.

- –≠—Ç–∞–ø 9 ‚Äî –ó–∞–ø–∏—Å—å —Å —É—á—ë—Ç–æ–º –∏–µ—Ä–∞—Ä—Ö–∏–∏
–ï—Å–ª–∏ –æ—Ç–º–µ—Ç–∫–∏ –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–∞—è.

–ï—Å–ª–∏ –æ—Ç–º–µ—Ç–∫–∞ –µ—Å—Ç—å:

–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ª—é–±—ã–µ –æ—Ç–º–µ—Ç–∫–∏.

–°—Ç–∞—Ä–æ—Å—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π/–¥–µ–∫–∞–Ω–∞—Ç–∞.

–û–±—ã—á–Ω—ã–π —Å—Ç—É–¥–µ–Ω—Ç –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –æ—Ç–º–µ—Ç–∫–∏.

## 3. –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
–ü–æ–ª—É—á–∞–µ–º –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ.

–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∑–∞–Ω—è—Ç–∏—è.

–ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –æ—Ç–º–µ—Ç–∫–∞.

–û–ø—Ä–µ–¥–µ–ª—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –µ—ë –∏–∑–º–µ–Ω–∏—Ç—å.

–í—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ ClickHouse.

–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ Kafka.

–í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç.

## 4. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ClickHouse –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–Ω–æ–≤–∞—è –æ—Ç–º–µ—Ç–∫–∞ ‚Äî –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞).

Kafka –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–±—ã—Ç–∏–π–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

–õ–æ–≥–∏–∫–∞ —Ä–æ–ª–µ–≤–æ–π –º–æ–¥–µ–ª–∏ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PushPull.
